/*! scripts/tumblr/utils/exceptions.js */
(function(C,H){var A=C.document;var a=C.encodeURIComponent;var e=C.navigator;var v=C.parseInt;var t=C.performance;var o=C.window;var f=C.Date;var G=C.Error;var p=C.Math;var y=C.XMLHttpRequest;var h=[];var r=[];var g={};var k=false;function z(K,J,L,I){K.addEventListener?K.addEventListener(J,L,!!I):K.attachEvent&&K.attachEvent("on"+J,L,!!I)}function c(J,I){return(typeof J==="string")&&(J.length>I)?[J.slice(0,I/2),"...",J.length-I,"...",J.slice(-I/2)].join(""):J}function q(M,K){var N=[];for(var L in M){if(!M.hasOwnProperty(L)){continue}var J=K?(K+"["+L+"]"):L,I=M[L];N.push(typeof I==="object"?q(I,J):a(J)+"="+a(I))}return N.join("&")}var w=(function(I){return(I&&I.keys)||function(M){var J=[];var L=I.prototype.hasOwnProperty;for(var K in M){L.call(M,K)&&J.push(K)}return J}})(C.Object);var F=function(J,M,K){if(typeof M!=="function"){return}var I=(J&&J.length)>>>0;for(var L=0;L<I;L++){M.call(K,J[L],L,J)}};var B=(function(I){return(I&&I.stringify&&function(K){try{return I.stringify(K)}catch(J){E(J);return'"FAILED_JSON_STRINGIFY"'}})||function(){return'"NO_JSON_STRINGIFY"'}})(C.JSON);var j=(function(I){return(I&&I.Flags)||(function(){E(new G("Missing Tumblr.Flags in exceptions.js"));var J={enable_js_errors_log:true,enable_js_ephemeral_log:true};function K(L,M){return(typeof L==="function")?L.call(this,M):L}return function(M){var L=!!(J[M]);return function N(P,Q){var O=K.call(this,(L?P:Q),L);return(O!==void 0)?O:N}}})()})(C.Tumblr);function E(J,I){if(typeof I==="number"&&p.random()>I){return}if(J instanceof G){J.url||(J.url="//www.tumblr.com/");l(J.message,J.url,J.ln,J.col,J)}else{h.push(B(J))}}var x=/https?:\/\//;var n=/https?:\/\/[^/]*tumblr[^/]*/;function l(M,J,L,I,K){try{J=c(J,300)||"";if(x.test(J)&&!n.test(J)){return}K=B(c(K&&K.stack,1000)||"");if(x.test(K)&&!n.test(K)){return}r.push({path:(A.location||{}).pathname||"NO_LOCATION_OR_PATHNAME",msg:c(M,200)||"",url:J,ln:v(L,10)||-1,col:v(I,10)||-1,err:K,group:j("js_errors_a")("A",j("js_errors_b")("B","*"))})}catch(K){}}function b(){return((A.head||{}).innerHTML||"").indexOf("#missinge_button")!==-1}var i=E.debugDump=function(){var I=[];F(A.getElementsByTagName("script"),function(J){I.push(J.src)});return{timestamp:+new f(),path:(A.location||{}).href||"NO_HREF",lang:(e||{}).userLanguage||(e||{}).language||"NO_LANG",referrer:A.referrer||"NO_REFERRER",ua:(e||{}).userAgent||"NO_UA",timing:(t||{}).timing||"NO_TIMING",scripts:I,globals:w(C),cookie:A.cookie,ephemeral:h,errors:r,document:(A.documentElement||{}).innerHTML||"NO_DOCUMENT"}};function s(I){var J=i();J.name=I;return B(J)}function m(){try{if(!k){r.length=0;E(new G("PAGE_DID_NOT_LOAD"))}var I;!b()&&j("enable_js_errors_log")(function(){r.length&&((I||(I={})).errors=r)});j("js_performance_logging")(function(){try{if(!t||!t.getEntriesByType){return}var L=t.getEntriesByType("resource");F(L,function(O){if(O.initiatorType!=="img"){return}var N=(O.name.match(/\/\/([^/]+)/)||"")[1];if(N.indexOf(".tumblr.")===-1){return}var P=N.split(".")[0];g.entries||(g.entries=[]);g.entries.push({name:O.name.split("tumblr.com/")[1],duration:O.duration,bucket:P})});if(w(g)){((I||(I={})).perf=g);g.timing=t.timing}}catch(M){}});j("enable_js_ephemeral_log")(function(){h.length&&((I||(I={})).ephemeral=h)});j("js_debugger_1")(function(){(I||(I={})).ephemeral=[s("js_debugger_1")]});j("js_debugger_2")(function(){(I||(I={})).ephemeral=[s("js_debugger_2")]});if(!I){return}var K=new y();K.open("POST","/svc/log/capture/exceptions",false);K.setRequestHeader("Content-type","application/x-www-form-urlencoded");K.onreadystatechange=function(){if(K.readyState!==4){return}r.length=h.length=0};K.send(q({form_key:(A.getElementById("tumblr_form_key")||A.body).getAttribute("content"),log:I}))}catch(J){if(!C.jQuery){return}E(J);(I||(I={})).errors||(I.errors=r);C.jQuery.ajax({async:false,type:"POST",data:{form_key:C.jQuery("#tumblr_form_key").attr("content"),log:I},url:"/svc/log/capture/exceptions",with_form_key:true})}}(function D(){z(o,"beforeunload",m);o.onerror=l})();(H.Utils||(H.Utils={})).exceptions=E;function u(){if(!t||!t.timing){return}try{var I=new f().getTime();var K=I-t.timing.navigationStart;g.page_load_time=K}catch(J){}}function d(){k=true;u()}z(o,"load",d)})(this,this.Tumblr||(this.Tumblr={}));